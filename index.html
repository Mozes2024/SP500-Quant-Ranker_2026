<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S&P 500 Mozes Ranker - DEBUG</title>
<style>
body{background:#070c12;color:#dce8f4;font-family:monospace;padding:20px;}
.ok{color:#00d4aa;}.err{color:#ff4757;}.warn{color:#f5a623;}
#log{margin-top:20px;font-size:13px;line-height:2;}
</style>
</head>
<body>
<h2 style="color:#f5a623">S&P 500 Mozes Ranker - DEBUG MODE</h2>
<div id="log"></div>

<script>
// ── DEBUG LOGGER ──────────────────────────────
const log = document.getElementById('log');
function dbg(msg, type='ok') {
  const d = document.createElement('div');
  d.className = type;
  d.textContent = (type==='ok'?'✓ ':type==='err'?'✗ ':'⚠ ') + msg;
  log.appendChild(d);
  console.log('[DEBUG]', msg);
}

window.onerror = function(msg, src, line, col, err) {
  dbg('JS ERROR at line ' + line + ': ' + msg, 'err');
};

dbg('Script started');

// ── STEP 1: Basic JS works ─────────────────────
try {
  const test = [1,2,3].map(x => x*2);
  dbg('Arrow functions OK');
} catch(e) { dbg('Arrow functions FAIL: '+e, 'err'); }

// ── STEP 2: async/await ────────────────────────
try {
  async function testAsync() { return 42; }
  testAsync().then(v => dbg('async/await OK, val=' + v));
} catch(e) { dbg('async/await FAIL: '+e, 'err'); }

// ── STEP 3: fetch sp500_data.json ──────────────
dbg('Starting fetch of sp500_data.json...');
fetch('sp500_data.json?v=' + Date.now())
  .then(r => {
    dbg('Fetch response: HTTP ' + r.status + ' ' + (r.ok?'OK':'FAIL'), r.ok?'ok':'err');
    if (!r.ok) throw new Error('HTTP ' + r.status);
    return r.json();
  })
  .then(json => {
    dbg('JSON parsed OK');
    if (json && json.data) {
      dbg('json.data exists, length=' + json.data.length);
      dbg('First ticker: ' + (json.data[0] && json.data[0].ticker));
      dbg('Generated: ' + json.generated);
    } else {
      dbg('json.data is MISSING or empty!', 'warn');
      dbg('JSON keys: ' + Object.keys(json).join(', '), 'warn');
    }
  })
  .catch(e => {
    dbg('FETCH ERROR: ' + e.message, 'err');
    if (e.message.includes('404')) {
      dbg('→ sp500_data.json NOT FOUND - Actions need to run', 'warn');
    } else if (e.message.includes('Failed to fetch')) {
      dbg('→ Network error or CORS issue', 'warn');
    }
  });

dbg('Script reached end (no crash before fetch)');
</script>
</body>
</html>
